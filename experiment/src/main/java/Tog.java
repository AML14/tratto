import data.OperationType;
import data.TogType;

import java.nio.file.Path;
import java.nio.file.Paths;

/**
 * This class represents the main file used in {@code experiment.jar}, with
 * all necessary operations for the end-to-end experiment process, including:
 * <ul>
 *     <li>Removing oracles</li>
 *     <li>Inserting oracles</li>
 *     <li>Preprocessing TOG input</li>
 *     <li>Postprocessing TOG output</li>
 *     <li>Summarizing test suite results</li>
 *     <li>Summarizing Defects4J results</li>
 * </ul>
 * The various operations require different arguments, following the format:
 * <ul>
 *     <li>{@code java -jar experiment.jar toga remove_oracles
 *     "path/to/evosuite-tests" tutorial.Stack}</li>
 *     <li>{@code java -jar experiment.jar jdoctor insert_oracles
 *     "path/to/src/main" "path/to/oracle/output.json"}</li>
 *     <li>{@code java -jar experiment.jar toga generate_tog_inputs
 *     "path/to/src/main" tutorial.Stack}</li>
 *     <li>{@code java -jar experiment.jar jdoctor generate_oracle_outputs
 *     path/to/jdoctor/output.json}</li>
 * </ul>
 */
public class Tog {
    /**
     * Inserts the OracleOutput records generated by a TOG into the prefixes
     * generated by EvoSuite.
     *
     * @param togType a TOG
     * @param oraclesPath the path to the OracleOutput JSON file
     */
    private static void insertOraclesOperation(TogType togType, Path binDir, Path oraclesPath) {
    }

    /**
     * Preprocesses the given input to be valid for the specified TOG.
     *
     * @param togType a TOG
     * @param srcDir the directory to the project source code
     * @param fullyQualifiedName the fully qualified name of the class under
     *                           test
     */
    private static void generateTogInputOperation(TogType togType, Path srcDir, String fullyQualifiedName) {
    }

    /**
     * Converts the output of a given TOG to a list of OracleOutput records.
     *
     * @param togType a TOG
     * @param dir the directory for mapping outputs. For TOGA, the source
     *            directory is used to resolve types. For JDoctor and Tratto,
     */
    private static void generateOracleOutputOperation(
            TogType togType,
            Path dir
    ) {
    }

    /**
     * Creates a TestOutput record to summarize a test suite generated by a
     * TOG.
     *
     * @param tog a TOG
     * @param fullyQualifiedName the fully qualified name of the class under
     *                           test
     * @param srcDir the source directory of the project under test
     * @param binDir the system binaries of the project under test
     * @param experimentRoot the experiment module root directory
     */
    private static void generateTestOutputOperation(
            TogType tog,
            String fullyQualifiedName,
            Path srcDir,
            Path binDir,
            Path experimentRoot
    ) {
    }

    /**
     * Converts a directory of TestOutput objects into a Defects4JOutput.
     *
     * @param togType a TOG
     * @param dir a directory of TestOutputs for each Defects4J project
     */
    private static void generateDefects4JOutput(TogType togType, Path dir) {
    }

    /**
     * The main method handles all invocations of the JAR file.
     *
     * @param args arguments passed for each JAR invocation
     */
    public static void main(String[] args) {
        TogType togType = TogType.valueOf(args[0].toUpperCase());
        OperationType operationType = OperationType.valueOf(args[1].toUpperCase());
        switch (operationType) {
            case REMOVE_ORACLES -> OracleRemover.removeOracles(
                    Paths.get(args[2]),
                    args[3]
            );
            case INSERT_ORACLES -> insertOraclesOperation(
                    togType,
                    Paths.get(args[2]),
                    Paths.get(args[3])
            );
            case GENERATE_TOG_INPUT -> generateTogInputOperation(
                    togType,
                    Paths.get(args[2]),
                    args[3]
            );
            case GENERATE_ORACLE_OUTPUT -> generateOracleOutputOperation(
                    togType,
                    Paths.get(args[2])
            );
            case GENERATE_TEST_OUTPUT -> generateTestOutputOperation(
                    togType,
                    args[2],
                    Paths.get(args[3]),
                    Paths.get(args[4]),
                    Paths.get(args[5])
            );
            case GENERATE_DEFECTS4J_OUTPUT -> generateDefects4JOutput(
                    togType,
                    Paths.get(args[2])
            );
            default -> throw new IllegalArgumentException("Unknown operation " + operationType);
        }
    }
}
